# 2025-12-31 변경 사항 (Changelog)

## 🆕 새로운 기능 (New Features)

### 1. 선호 교통수단 기반 경로 안내 (Personalized Routing)
- **자연어 의도 파악 강화**: Gemini LLM 프롬프트를 고도화하여 목적지뿐만 아니라 **"버스로 갈래"**, **"지하철로 안내해줘"** 등 사용자가 선호하는 교통수단을 함께 추출합니다.
- **맞춤형 경로 필터링**: 사용자가 선택한 수단(Bus, Subway, Rail 등)을 Google Routes API에 전달하여 해당 수단 위주로 경로를 탐색합니다.

### 2. 스마트 폴백 가이드 (Smart Fallback Guidance)
- **자동 경로 보정**: 사용자가 요청한 교통수단만으로 이동이 불가능하거나 경로가 없는 경우, 시스템이 이를 감지하여 **자동으로 최적 경로(최단 시간)**를 다시 검색합니다.
- **친절한 음성 안내**: 경로 재검색 시 사용자에게 "요청하신 교통수단으로 이동이 어려워, 최적 경로로 안내합니다."라는 명확한 음성 피드백을 제공하여 혼란을 방지합니다.

## 🛠 개선 사항 (Improvements)
- `APIService`의 `fetchRoute` 로직을 개선하여 선호 수단 지정 및 Fallback 처리를 위한 파라미터(`preferredModes`, `isFallbackApplied`)를 추가했습니다.
- 경로 검색 실패 시 단순히 에러를 띄우는 대신, 가능한 대안을 찾아 끊김 없는 경험을 제공하도록 UX를 강화했습니다.

---


## 🔄 주요 업데이트

### 1. 한국어 문화화 (Culturalization) 및 TTS 개선
- **안내 메시지 수정**: "듣고 있어요" → "듣고 있습니다" 등 전체적인 어조를 더욱 정중하고 자연스럽게 개선했습니다.
- **스마트 조사 처리(Smart Josa)**: MapKit 대중교통경로안내 데이터에도 받침 자동 감지 로직을 적용하여, "2호선**을** 탑승"과 같이 조사가 자연스럽게 연결되도록 했습니다.
- **소요 시간 안내**: 경로 요약 브리핑 시 "총 소요 시간"을 음성으로 함께 안내하도록 기능을 추가했습니다.

### 2. 사용자 경험 (UX) 최적화
- **탭 리프레시(Tab Refresh)**: 하단 탭을 다시 터치하면 각 기능(주변 탐색, SOS 위치 안내 등)이 즉시 재실행되도록 개선했습니다.
- **탭 전환 시 음성 중단**: 탭을 이동할 때 이전 화면의 음성 안내가 즉시 멈추고 새로운 안내가 시작되도록 로직을 강화했습니다.

### 3. 기능 및 구조 개선
- **도보 단계 필터링**: 사용자의 요청에 따라 대중교통 경로에서 번거로운 '도보 이동' 상세 단계를 생략하고, 탑승/환승 위주의 핵심 정보만 제공합니다. (대중교통경로안내 최적화)
- **위치 서비스 구조 개선**: `LocationManager`를 앱 전역(`EnvironmentObject`)으로 승격시켜 탭 간 위치 정보 충돌 및 초기화 경합 문제를 해결했습니다.
- **명칭 정밀화**: 메뉴 이름을 '경로 안내'에서 '대중교통경로안내'로 변경하여 기능의 목적을 더 명확하게 정의했습니다. 이에 따라 모든 기술 문서와 연구 문서의 명칭도 일괄 업데이트했습니다.
- **주변 탐색 정밀도 개선**: 현재 사용자가 위치한 건물(POI)을 인식하여 검색 결과에서 자동으로 제외하는 로직을 추가했습니다. (거리 5m 이내 및 명칭 일치 기준)

## 🐛 버그 수정
- `APIService` 및 `ContentView`의 문법 오류 수정.
- 앱 실행 초기 위치 권한 요청 시 발생하던 레이스 컨디션(Race Condition) 프리징 해결.
